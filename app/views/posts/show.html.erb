<% provide(:title, "Show Post") %>
<!-- 投稿詳細 -->
<section class="show-post">
  <div class="posts-container">
    <div class="posts-contents">
      <div class="post-area">
        <figure>
          <% if current_user.id == @post.user_id %>
            <%= link_to image_tag(avatar_url(@post.user), class: "posted-user-icon", alt: "ユーザーアイコン"), users_show_path %>
          <% else %>
            <%= link_to image_tag(avatar_url(@post.user), class: "posted-user-icon", alt: "ユーザーアイコン"), users_profile_path(name: @post.user.name) %>
          <% end %>
        </figure>
        <div class="post-area-text">
          <div class="posted-user-name"><%= @post.user.name %>(<%= @post.user.introduction %>)</div>
          <% if @post.user_id == current_user.id %>
            <div class="appear-menu-btn">•••</div>
            <div class="post-menu">
              <div class="sp-edit-delete-area">
                <p><%= link_to "投稿の編集", edit_post_path, class: "sp-post-edit-btn" %></p>
                <p><%= link_to "投稿の削除", @post, method: :delete, data: {confirm: "本当に投稿を削除しますか？"} %></p>
              </div>
            </div>
          <% end %>
          <div class="posted-date-show"><%= @post.created_at.strftime('%Y/%m/%d %H:%M') %></div>
          <% if @post.user_id == current_user.id %>
            <div class="edit-delete-area">
              <%= link_to edit_post_path do %>
                <span class="post-edit-link"><i class="fa fa-edit"></i></span>
              <% end %>
              <%= link_to @post, method: :delete, data: {confirm: "本当に投稿を削除しますか？"} do %>
                <span class="post-delete-link"><i class="fas fa-trash-alt left-trash"></i></span>
              <% end %>
            </div>
          <% end %>
          <div class="post-text">
            <span class="post-title"><%= @post.title %></span>
            <span class="post-content"><%= simple_format(@post.post_content) %></span>
            <% unless @post.avatar.blank? %>
              <div class="post-pict">
                <%= image_tag(post_image_url(@post), class: "post-image", alt: "投稿画像") %>
              </div>
            <% end %>
          </div>
          <div id="like-buttons-<%= @post.id %>">
            <%= render "likes/like_function", post: @post %>
          </div>
          <div id="remember-buttons-<%= @post.id %>">
            <%= render "remembers/remember_function", post: @post %>
          </div>
          <% if current_user.already_commented?(@post) %>
            <span class="comment-count" style="color: coral;"><i class="fa fa-comments"></i>&nbsp;<%= @post.comments.count %></span>
          <% else %>
            <span class="comment-count" style="color: silver;"><i class="fa fa-comments"></i>&nbsp;<%= @post.comments.count %></span>
          <% end %>
          <%= link_to "アクションしたユーザー一覧", "/posts/#{@post.id}/action_user", class: "action-user-link-btn" %>
          <div class="smart-phone-post-date"><%= @post.created_at.strftime('%Y/%m/%d %H:%M') %></div>
        </div>
      </div>
    </div>
  </div>
</section>
<a class="form-appear">この投稿にコメントする</a>
<%= render "comments/form", { post: @post, comment: @comment } %>
<!-- 投稿のコメント一覧 -->
<section class="comment-tree">
  <div class="comment_container">
    <div class="comment_contents">
      <% if @comments.count.zero? %>
        <div class="zero-info">まだコメントはありません</div>
      <% else %>
        <% @comments.each do |comment| %>
          <% if @post.user_id == comment.user_id %>
            <!-- 投稿主のコメント(右側) -->
            <div class="post-owner-comment">
              <div class="owner-text"><%= simple_format(comment.comment_content) %></div>
              <div class="comment-image">
                <% unless comment.avatar.blank? %>
                  <div class="comment-pict">
                    <%= image_tag(post_image_url(comment), alt: "コメント画像", class: "owner-pic") %>
                  </div>
                <% end %>
              </div>
              <% if current_user.id == comment.user.id %>
                <%= link_to post_comment_path(@post, comment), method: :delete, data: {confirm: "本当に削除しますか？"} do %>
                  <i class="fas fa-trash-alt right-trash"></i>
                <% end %>
              <% end %>
              <span class="comment-date"><%= comment.created_at.strftime('%m/%d %H:%M') %></span>
            </div>
          <% else %>
            <!-- その他ユーザーのコメント(左側) -->
            <div class="other-user-comment">
              <figure>
                <% if current_user.id == comment.user_id %>
                  <%= link_to image_tag(avatar_url(comment.user), class: "other-user-icon", alt: "ユーザーアイコン"), users_show_path %>
                <% else %>
                  <%= link_to image_tag(avatar_url(comment.user), class: "other-user-icon", alt: "ユーザーアイコン"), users_profile_path(name: comment.user.name) %>
                <% end %>
              </figure>
              <div class="other-user-text">
                <div class="other-name"><%= comment.user.name %>(<%= comment.user.introduction %>)</div>
                <div class="other-text"><%= simple_format(comment.comment_content) %></div>
                <div class="comment-image">
                  <% unless comment.avatar.blank? %>
                    <div class="comment-pict">
                      <%= image_tag(post_image_url(comment), alt: "コメント画像", class: "other-user-pic") %>
                    </div>
                  <% end %>
                </div>
                <% if current_user.id == comment.user.id %>
                  <%= link_to post_comment_path(@post, comment), method: :delete, data: {confirm: "本当にコメントを削除しますか？"} do %>
                    <i class="fas fa-trash-alt left-trash"></i>
                  <% end %>
                <% end %>
                <span class="comment-date"><%= comment.created_at.strftime('%m/%d %H:%M') %></span>
              </div>
            </div>
          <% end %>
        <% end %>
      <% end %>
    </div>
  </div>
</section>
<%= javascript_pack_tag 'post/show' %>
